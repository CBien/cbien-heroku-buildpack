#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e

TARGET_DIR=$HOME
BUILD_DIR=$1
CACHE_DIR=$2

cd $BUILD_DIR

# Gettext
export PATH=$HOME/gettext/bin:$PATH
make compilemessages

# Sass
export PATH=$HOME/.gem/bin:$PATH
make sass

# Migrations
if [ "$MIGRATE_ON_DEPLOY" = "1" ]; then
    python manage.py migrate --noinput
fi
