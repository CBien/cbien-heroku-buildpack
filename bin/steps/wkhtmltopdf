#!/usr/bin/env bash

set -e

WKHTMLTOPDF_FILENAME="wkhtmltopdf.tar.bz2"
WKHTMLTOPDF_BINARY="https://wkhtmltopdf.googlecode.com/files/wkhtmltopdf-0.11.0_rc1-static-amd64.tar.bz2"
WKHTMLTOPDF_BINARY_NAME="wkhtmltopdf-amd64"
WKHTMLTOPDF_PATH="/app/.heroku/vendor/bin/wkhtmltopdf"

echo "-----> wkhtmltopdf: Curl wkhtmltopdf compressed binary << $WKHTMLTOPDF_BINARY"
curl -L $WKHTMLTOPDF_BINARY -o $WKHTMLTOPDF_FILENAME

echo "-----> wkhtmltopdf: Decompressing binary << $WKHTMLTOPDF_FILENAME"
tar xjf $WKHTMLTOPDF_FILENAME

echo "-----> wkhtmltopdf : Removing compressed binary"
rm -f $WKHTMLTOPDF_FILENAME

echo "-----> wkhtmltopdf : Moving binary to the bin dir"
mv $WKHTMLTOPDF_BINARY_NAME $WKHTMLTOPDF_PATH

echo "-----> wkhtmltopdf : Setting permissions"
chmod +x $WKHTMLTOPDF_PATH