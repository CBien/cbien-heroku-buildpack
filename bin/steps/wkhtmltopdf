#!/usr/bin/env bash

set -e

BIN_PATH="$1/bin/"
mkdir -p $BIN_PATH

WKHTMLTOPDF_BINARY="http://sourceforge.net/projects/wkhtmltopdf/files/0.12.1/wkhtmltox-0.12.1_linux-trusty-amd64.deb/download"
WKHTMLTOPDF_PATH="$1/bin/wkhtmltopdf"
WKHTMLTOPDF_COMPRESSED_PATH="$1/bin/wkhtmltopdf.tar.xz"
WKHTMLTOX_PATH="$1/bin/wkhtmltox"

echo "-----> wkhtmltox : Transferring wkhtmltopdf compressed binary"
curl -L $WKHTMLTOPDF_BINARY -o $WKHTMLTOPDF_COMPRESSED_PATH

echo "-----> wkhtmltox : Decompressing binary"
tar xJf $WKHTMLTOPDF_COMPRESSED_PATH --directory $BIN_PATH

echo "-----> wkhtmltox : Removing compressed binary"
rm -f $WKHTMLTOPDF_COMPRESSED_PATH

echo "-----> wkhtmltox : Moving binary to the right place from wkhtmltox"
mv $WKHTMLTOX_PATH/bin/wkhtmltopdf $BIN_PATH

echo "-----> wkhtmltox : Removing wkhtmltox folder"
rm -rf $WKHTMLTOX_PATH

echo "-----> wkhtmltox : Setting permissions"
chmod +x $WKHTMLTOPDF_PATH