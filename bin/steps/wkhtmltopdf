#!/usr/bin/env bash

set -e

BIN_PATH="$1/bin/"
mkdir -p $BIN_PATH

WKHTMLTOPDF_FILENAME="wkhtmltopdf-0.11.0_rc1-static-amd64.tar.bz2"
WKHTMLTOPDF_BINARY="https://wkhtmltopdf.googlecode.com/files/$WKHTMLTOPDF_BINARY"
WKHTMLTOPDF_PATH="$1/bin/wkhtmltopdf"
WKHTMLTOX_PATH="$1/bin/wkhtmltox"

echo "-----> wkhtmltopdf : Transferring wkhtmltopdf compressed binary"
curl -O $WKHTMLTOPDF_BINARY >/dev/null 2>&1

echo "-----> wkhtmltopdf : Decompressing binary"
tar xjf $WKHTMLTOPDF_FILENAME >/dev/null 2>&1

# echo "-----> wkhtmltopdf : Removing compressed binary"
# rm -f $WKHTMLTOPDF_COMPRESSED_PATH

echo "-----> wkhtmltopdf : Moving binary to the right place from wkhtmltox"
mv wkhtmltopdf-amd64 $WKHTMLTOPDF_PATH

# echo "-----> wkhtmltopdf : Removing wkhtmltox folder"
# rm -rf $WKHTMLTOX_PATH

echo "-----> wkhtmltopdf : Setting permissions"
chmod +x $WKHTMLTOPDF_PATH